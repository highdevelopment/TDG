<!doctype html>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=1200, initial-scale=1.0, maxium-scale=1.0, minimum-scale=1.0, user-scalable=yes" />
		<meta name="format-detection" content="telephone=no" />
		<!-- Favicon -->
		<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
		<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
		<link rel="stylesheet" href="../style/css/reset.css" media="all">
		<title>더 도어스 스크린 골프 스윙 영상</title>
		<!--[if lt IE 9]>
			<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js" type="text/javascript"></script>
			<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/ie7-squish.js" type="text/javascript"></script>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
		<script type="text/javascript" src="../style/js/jquery-1.11.3.min.js"></script>
		<script type="text/javascript" src="../style/js/jquery.bxslider/jquery.bxslider.min.js"></script>
		<script type="text/javascript" src="../style/js/main.js"></script>
	</head>
	<body>

	<!--헤더-->
	{{>header}}
	<!--헤더-->

	<!--서브탑-->
	<div class="subTop">
		<div class="subTopInner">
			<h1>스윙영상</h1>
			<div class="location">
				<a href="#">COMMUNITY</a> > <span>스윙영상</span>
			</div>
		</div>
	</div>
	<!--서브탑-->

	<!--바디-->
	<article>
		<div id="bodyWrap">
		<!--내용시작-->
		<div class="wrap800">


<!--베스트-->
<div class="bestWrap">
	<!--오늘의베스트-->
	{{!-- <h3 class="todayBestH3 active"><a href="?gender={{params.gender}}&sort={{params.sort}}&type=0&page={{page.pageIndex}}">오늘의 베스트</a></h3> --}}
	<h3 class="todayBestH3 active"><a>오늘의 베스트</a></h3>
	<div class="todayBest">
		<div class="dateControl">
			{{!-- <a href="?gender={{params.gender}}&sort={{params.sort}}&type={{params.type}}&date={{params.beforeday}}&page={{page.pageIndex}}">&lt;</a> --}}
			<span id="btn_before_day" class="btn_date">&lt;</span>
			<span id="text_today">{{params.date}}</span>
			<span id="btn_next_day" class="btn_date">&gt;</span>
			{{!-- <a href="?gender={{params.gender}}&sort={{params.sort}}&type={{params.type}}&date={{params.nextday}}&page={{page.pageIndex}}">&gt;</a> --}}
		</div>
		<ul>
			<li>
				<section class="swingvideo" id="{{videos_best.0.id}}">
					<img src="{{videos_best.0.filepath_thumb}}" alt="" style="width: 420px;">
					<div>
						<h4>{{videos_best.0.user_nickname}}</h4>
						<h5>{{videos_best.0.clubName}}  {{videos_best.0.carry}}m<span>{{videos_best.0.time}}</span></h5>
						<p>
							<span class="btn_like" motion_id="{{videos_best.0.id}}">{{videos_best.0.like}}</span>
							{{!-- <span>{{this.chat_num}}</span> --}}
							<span>{{videos_best.0.visit}}</span>
						</p>
					</div>
				</section>
			</li>
			<li>
				<section class="swingvideo" id="{{videos_best.1.id}}">
					<img src="{{videos_best.1.filepath_thumb}}" alt="" style="width: 210px;">
					<div></div>
				</section>
			</li>
			<li>
				<section class="swingvideo" id="{{videos_best.2.id}}">
					<img src="{{videos_best.2.filepath_thumb}}" alt="" style="width: 210px;">
					<div></div>
				</a>
			</li>
		</ul>
	</div>
	<!--오늘의베스트-->
	<!--주간베스트-->
	{{!-- <h3 class="weekBestH3"><a href="?gender={{params.gender}}&sort={{params.sort}}&type=1&page={{page.pageIndex}}">주간 베스트</a></h3> --}}
	<h3 class="weekBestH3"><a>주간 베스트</a></h3>
	<div class="weekBest">
		<div class="dateControl">
			{{!-- <a href="?gender={{params.gender}}&sort={{params.sort}}&type={{params.type}}&date={{params.beforeweek}}&page={{page.pageIndex}}">&lt;</a> --}}
			<span id="btn_before_week" class="btn_date">&lt;</span>
			<span>2019.5.26</span>
			<span id="btn_next_week" class="btn_date">&gt;</span>
			{{!-- <a href="?gender={{params.gender}}&sort={{params.sort}}&type={{params.type}}&date={{params.nextweek}}&page={{page.pageIndex}}">&gt;</a> --}}
		</div>
		<ul>
			<li>
				<section class="swingvideo" id="{{videos_best.0.id}}">
					<img src="{{videos_best.0.filepath_thumb}}" alt="" style="width: 420px;">
					<div>
						<h4>{{videos_best.0.user_nickname}}</h4>
						<h5>{{videos_best.0.clubName}}  {{videos_best.0.carry}}m<span>{{videos_best.0.time}}</span></h5>
						<p>
							<span class="btn_like" motion_id="{{videos_best.0.id}}">{{videos_best.0.like}}</span>
							{{!-- <span>{{this.chat_num}}</span> --}}
							<span>{{videos_best.0.visit}}</span>
						</p>
					</div>
				</section>
			</li>
			<li>
				<section class="swingvideo" id="{{videos_best.1.id}}">
					<img src="{{videos_best.1.filepath_thumb}}" alt="" style="width: 210px;">
					<div></div>
				</section>
			</li>
			<li>
				<section class="swingvideo" id="{{videos_best.2.id}}">
					<img src="{{videos_best.2.filepath_thumb}}" alt="" style="width: 210px;">
					<div></div>
				</a>
			</li>
		</ul>
	</div>
	<!--주간베스트-->
</div>
<!--베스트-->

<!--정렬-->
<div class="tabCategory">
	<ul class="gender">
		<li><a href="?gender=0&sort={{params.sort}}&type={{params.type}}&date={{params.date}}">전체</a></li>
		<li><a href="?gender=1&sort={{params.sort}}&type={{params.type}}&date={{params.date}}">남자</a></li>
		<li><a href="?gender=2&sort={{params.sort}}&type={{params.type}}&date={{params.date}}">여자</a></li>
	</ul>
	<ul class="listUp">
		<li ><a href="?gender={{params.gender}}&sort=0&date={{params.date}}">최신순</a></li>
		<li><a href="?gender={{params.gender}}&sort=1&date={{params.date}}">좋아요순</a></li>
		<li><a href="?gender={{params.gender}}&sort=2&date={{params.date}}">조회순</a></li>
		{{!-- <li><a href="?gender={{params.gender}}&sort=3&date={{params.date}}">댓글순</a></li> --}}
	</ul>
</div>
<!--정렬-->

<!--목록-->
<ul class="swingList">
	{{#each videos}}
		<li>
			<section class="swingvideo" id="{{this.id}}">
				<img src={{this.filepath_thumb}}>
			</section>
			<h4>{{this.clubName}} {{toFixed this.carry 2}}m<span>{{this.time}}</span></h4>
			<p>
				<span class="btn_like" motion_id="{{this.id}}">{{this.like}}</span>
				{{!-- <span>{{this.chat_num}}</span> --}}
				<span>{{this.visit}}</span>
			</p>
		</li>
	{{/each}}
</ul>
<!--목록-->

 <!--페이징-->
	<div class="paging">
		<a href="?gender={{params.gender}}&sort={{params.sort}}&type={{params.type}}&date={{params.date}}&page={{page.prevPage10}}" class="prev10 {{page.prev10_disable}}">이전10</a>
		<a href="?gender={{params.gender}}&sort={{params.sort}}&type={{params.type}}&date={{params.date}}&page={{page.prevPage}}" class="prev {{page.prev_disable}}">이전</a>
		{{#for page.start page.end 1}}
			{{#if (eq @root.page.pageIndex this)}}
				<a href="?gender={{@root.params.gender}}&sort={{@root.params.sort}}&type={{params.type}}&date={{@root.params.date}}&page={{this}}" class="on">{{math this "+" 1}}</a>
			{{else}}
				<a href="?gender={{@root.params.gender}}&sort={{@root.params.sort}}&type={{params.type}}&date={{@root.params.date}}&page={{this}}" class="">{{math this "+" 1}}</a>
			{{/if}}
		{{/for}}
		<a href="?gender={{params.gender}}&sort={{params.sort}}&type={{params.type}}&date={{params.date}}&page={{page.nextPage}}" class="next {{page.next_disable}}">다음</a>
		<a href="?gender={{params.gender}}&sort={{params.sort}}&type={{params.type}}&date={{params.date}}&page={{page.nextPage10}}" class="next10 {{page.next10_disable}}">다음10</a>
	</div>
 <!--페이징-->


		</div>
		<!--내용끝-->


		</div>
	</article>
	<!--바디-->

	{{>footer}}

	<div class="dialog">
		<section class="swingSection">
    		<span class="close">&times;</span>
			<section class="swingSectionInner">
				<section class="videoplay">
					<video id="video-element" width="320px" height="240px">
						<source src="" type="video/mp4">
					</video>
					<div id='controls'>
						<div style="margin-top: -11px;">
							<progress id='progress-bar' min='0' max='100' value='0'>0% played</progress>
						</div>
						<section style="box-shadow: -1px -1px #aaa;height: 35px;">
							<button id='btnStop' class='stop' title='stop' accesskey="X" onclick='stopVideo();'style="margin-left: 60px;"></button>
							<button id='btnPrev' class='prev' title='prev' accesskey="" onclick='prevVideo();'></button>
							<button id='btnPlayPause' class='play' title='play' accesskey="P" onclick='playPauseVideo();'></button>
							<button id='btnNext' class='next' title='next' accesskey="" onclick='nextVideo();'></button>
							<select id="select_speed">
								<option value="1">1</option>
								<option value="0.5">1/2</option>
								<option value="0.25">1/4</option>
								<option value="0.125">1/8</option>
							</select>
						</section>
					</div>
				</section>
				<section class="motion_data">
					<ul>
						<li><label>일시</label>&emsp;<span id="motion_time"></span></li>
						<li><label>장소</label>&emsp;<span id="motion_storeName"></span></li>
						<li><label>구분</label>&emsp;<span id="motion_difficulty"></span></li>
						<li><label>모드</label>&emsp;<span id="motion_mode">스트로크</span></li>
						<li><label>코스</label>&emsp;<span id="motion_courseName"></span></li>
						<li><label>홀</label>&emsp;<span id="motion_holeIndex"></span></li>
						<li><label>클럽</label>&emsp;<span id="motion_club"></span></li>
						<li><label>구질</label>&emsp;<span>슬라이스</span></li>
						<li><label>비거리</label>&emsp;<span id="motion_carry"></span></li>
					</ul>
				</section>
			</section>
		</section>
	</div>

	<script>
		player = document.getElementById('video-element');
		player.addEventListener('timeupdate', updateProgressBar, false);
		player.addEventListener('play', function() {
			// Change the button to be a pause button
			changeButtonType(btnPlayPause, 'pause');
		}, false);
		player.addEventListener('pause', function() {
			// Change the button to be a play button
			changeButtonType(btnPlayPause, 'play');
		}, false);
		player.addEventListener('ended', function() { this.pause(); }, false);	

		btnPlayPause = document.getElementById('btnPlayPause');

		progressBar  = document.getElementById('progress-bar');
		progressBar.addEventListener("click", function(e) {
			var percent = e.offsetX / this.offsetWidth;
			player.currentTime = percent * player.duration;
			e.target.value = Math.floor(percent / 100);
			e.target.innerHTML = progressBar.value + '% played';
		});

		select_speed = document.getElementById('select_speed');
		select_speed.addEventListener("change", function(e) {
			const fVal = e.target.value * 1;
			player.playbackRate = fVal;
		})

		function updateProgressBar() {
			// Work out how much of the media has played via the duration and currentTime parameters
			var percentage = 0;
			if (!isNaN(player.duration)) {
				percentage = Math.floor((100 / player.duration) * player.currentTime);
			}
			// Update the progress bar's value
			progressBar.value = percentage;
			// Update the progress bar's text (for browsers that don't support the progress element)
			progressBar.innerHTML = percentage + '% played';
		}
		function changeButtonType(btn, value) {
			btn.title     = value;
			btn.className = value;
		}
		function resetPlayer() {
			progressBar.value = 0;
			// Move the media back to the start
			player.currentTime = 0;
			// Set the play/pause button to 'play'
			changeButtonType(btnPlayPause, 'play');
		}

		function stopVideo() {
			player.playbackRate = 1;
			select_speed.value = 1;
			player.pause();
			if (player.currentTime) player.currentTime = 0;
		}
		function playPauseVideo() {
			if (player.paused || player.ended) {
				// Change the button to a pause button
				changeButtonType(btnPlayPause, 'pause');
				player.play();
			}
			else {
				// Change the button to a play button
				changeButtonType(btnPlayPause, 'play');
				player.pause();
			}
		}

		function prevVideo() {
			
		}
		function nextVideo() {

		}


		function makeDateString(date) {
			let month = '' + (date.getMonth() + 1);
			let day = '' + date.getDate();
			let year = date.getFullYear();

			// if (month.length < 2) month = '0' + month;
			// if (day.length < 2) day = '0' + day;
			return [year, month, day].join('.');
		}
		function parseDateString(strDate) {
			if (strDate && strDate.length > 0) {
				const d = strDate.split('.');
				return new Date(d[0], d[1], d[2]);
			}
			return new Date();
		}
		
		$(window).scroll(function() {
			sessionStorage.scrollTop = $(this).scrollTop();
		});
		$(document).ready(function() {
			$('.tabCategory .gender li a').eq({{params.gender}}).addClass('active');
			$('.tabCategory .listUp li a').eq({{params.sort}}).addClass('active');

			{{!-- if (sessionStorage.scrollTop != "undefined") {
				$(window).scrollTop(sessionStorage.scrollTop);
			} --}}
			const date = new Date(); //parseDateString('{{date}}');
			const strToday = makeDateString(date);
			$('#text_today').text(strToday);

			$('.dialog').hide();
			$('.dialog .close').click(function(e) {
				$('.dialog').hide();
			})

			$('.swingvideo').click(function(e) {
				const api_url = "{{api_url}}";
				const fileserver_url = '{{fileserver_url}}';
				var motionId = $(this).attr('id');
				$.get(api_url + 'api/MotionVideos/get-video?videoId=' + motionId, function(result) {
					if (result.res.success) {
						var resMotion = result.res.result;
						$('#video-element source').attr('src', fileserver_url + resMotion.filepath);
						$('#video-element')[0].load();
						$('#motion_time').text(resMotion.time);
						$('#motion_storeName').text(resMotion.storeName);
						$('#motion_difficulty').text('');
						$('#motion_courseName').text(resMotion.courseName);
						$('#motion_holeIndex').text(resMotion.holeIndex);
						$('#motion_club').text(resMotion.clubName);
						$('#motion_carry').text(resMotion.carry);
						$('.dialog').show();
						changeButtonType(btnPlayPause, 'play');
					} else {
						alert(result.res.result);
					}
				});
			})

			$('.btn_like').click(function(e) {
				const api_url = "{{api_url}}";
				const motionId = $(this).attr('motion_id');
				const access_token = "{{user.access_token}}";
				if (access_token) {
					var params = {
						access_token: access_token,
						motionId: motionId,
					}
					$.post(api_url + 'api/MotionVideos/like-video?access_token=' + access_token, params, function(result) {
						if (result.res.success) {
							
						}
					})
				} else {
					alert('먼저 로그인을 하여주세요.');
				}
			})
		})
	</script>
	</body>
</html>
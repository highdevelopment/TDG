<!doctype html>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=1200, initial-scale=1.0, maxium-scale=1.0, minimum-scale=1.0, user-scalable=yes" />
		<meta name="format-detection" content="telephone=no" />
		<!-- Favicon -->
		<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
		<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
		<link rel="stylesheet" href="../style/css/reset.css" media="all">
		<title>더 도어스 스크린 골프 회원가입</title>
		<!--[if lt IE 9]>
			<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js" type="text/javascript"></script>
			<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/ie7-squish.js" type="text/javascript"></script>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
		<script type="text/javascript" src="../style/js/jquery-1.11.3.min.js"></script>
		<script type="text/javascript" src="../style/js/jquery.bxslider/jquery.bxslider.min.js"></script>
		<script type="text/javascript" src="../style/js/main.js"></script>
	</head>
	<body>

	<!--헤더-->
	{{>header}}
	<!--헤더-->

	<!--서브탑-->
	<div class="subTop">
		<div class="subTopInner">
			<h1>회원가입</h1>
			<div class="location">
				<a href="#">회원</a> > <span>회원가입</span>
			</div>
		</div>
	</div>
	<!--서브탑-->

	<!--바디-->
	<article>
		<div id="bodyWrap">
		<!--내용시작-->
		<div class="wrap1200">
	
	
<div class="memberForm">
	<h2>회원정보입력</h2>

	<dl>
		<dt>휴대폰 번호</dt>
		<dd class="cellPhone">
			<select id="phone_number_prefix" name="" title="통신망 공급자 선택">
				<option value="010">010</option>
			</select>
			-
			<input type="text" id="phone_number1" name="" value="" title="앞자리" maxlength="4">
			-
			<input type="text" id="phone_number2" name="" value="" title="뒷자리" maxlength="4">
			<input type="button" id="btn_AskVerify" name="" value="휴대폰 인증" title="휴대폰 인증" class="btnBlue">
		</dd>
	</dl>

	<dl>
		<dt>인증번호</dt>
		<dd class="cellPhone">
			<input type="text" id="verify_key" name="" value="" title="인증번호" disabled>
			<input type="button" id="btn_CheckVerify" name="" value="확인" title="확인" class="btnBlue" disabled>
			<p id="label_verify" class="notify_label_error">인증요청을 해주십시오.<p>
		</dd>
	</dl>

	<dl>
		<dt>이름</dt>
		<dd><input type="text" name="textfield" id="text_realname"  title="이름" placeholder="이름" /></dd>
	</dl>

	<dl>
		<dt>닉네임</dt>
		<dd>
			<input type="text" name="textfield" id="text_nickname"  title="닉네임" placeholder="닉네임" />
			<input type="button" id="btn_CheckNickName" name="" value="중복확인" title="중복확인" class="btnBlue">
			<label id="label_checkNickName" class="notify_label_error">닉네임 중복검사</label>
		</dd>
	</dl>

	<dl>
		<dt>생년월일</dt>
		<dd>
			<select name="select" id="birthday_year" title="년도">
			</select>
			<select name="select" id="birthday_month" title="월">
			</select>
			<select name="select" id="birthday_days" title="일">
			</select>
		</dd>
	</dl>

	<dl>
		<dt>성별</dt>
		<dd>
			<input type="radio" name="sex" id=""  title="여성" value="male"/><b>여성</b>
			<input type="radio" name="sex" id=""  title="남성" value="female" checked/><b>남성</b>
		</dd>
	</dl>

	<dl>
		<dt>주소</dt>
		<dd>
			<input type="text" name="textfield" id="text_postnumber"  title="우편번호" placeholder="우편번호" style="width:100px;" />
			<input type="submit" name="button" id="btn_search_postnumber" value="우편번호검색" title="우편번호검색" class="btnPostcode"  />
			<input type="text" name="textfield" id="text_address1"  title="주소" placeholder="주소" class="w100" />
			<input type="text" name="textfield" id="text_address2"  title="주소" placeholder="나머지 주소를 입력해 주세요. " class="w100" />
		</dd>
	</dl>

	<dl>
		<dt>아이디</dt>
		<dd>
			<input type="text" name="textfield" id="text_username"  title="아이디" placeholder="영문, 숫자 조합 4-14 자리" />
			<input type="button" id="btn_CheckId" name="" value="중복확인" title="중복확인" class="btnBlue">
			<span id="label_checkId" class="notify_label_error">아이디 중복검사</span>
		</dd>
	</dl>

	<dl>
		<dt>비밀번호</dt>
		<dd><input type="password" name="textfield" id="text_password"  title="비밀번호" placeholder="영문, 숫자, 특수문자 조합 4-14 자리" /><br>
		{{!-- <span id="label_checkPassword" class="notify_label_error">입력정보가 올바르지 않습니다.</span></dd> --}}
	</dl>

	<dl>
		<dt>비밀번호 재확인</dt>
		<dd><input type="password" name="textfield" id="text_password2"  title="비밀번호 재확인" placeholder="영문, 숫자, 특수문자 조합 4-14 자리" /><br>
		{{!-- <span id="label_checkPassword2" class="notify_label_error">입력정보가 올바르지 않습니다.</span></dd> --}}
	</dl>

	<div class="memberFormJoin"><input type="submit" name="button" id="btn_OK" value="회원가입" title="회원가입" class="btnJoin"  /></div>
</div>


		<div>
		<!--내용끝-->
		</div>
	</article>
	<!--바디-->

	{{>footer}}

	<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
	<script>
		$.fn.switchClass = function(a, b){
			var t = $(this).hasClass(a);
			$(this).addClass( t ? b : a ).removeClass( t ? a : b );
		}
		$(document).ready(function() {
			const api_url = "{{api_url}}";

			$('#btn_AskVerify').click(function() {
				var phone_number_prefix = $('#phone_number_prefix').val();
				var phone_number1 = $('#phone_number1').val();
				var phone_number2 = $('#phone_number2').val();
				var phone_number = phone_number_prefix + phone_number1 + phone_number2;
				if (!phone_number) {
					return alert('전화번호를 입력해주십시오.');
				}
				if(phone_number.length < 8) {
					return alert('정확한 전화번호를 입력해주십시오.');
				}
				var params = {
					phone_number: phone_number
				}
				$.post(api_url + 'api/Accounts/ask-verify', params, function(result) {
					if (result.res.success) {
						alert('인증번호를 발송하였습니다.');
						$('#verify_key').prop('disabled', false);
						$('#btn_CheckVerify').prop('disabled', false);
						$('#label_verify').text('인증코드를 입력해주세요.');
						$('#label_verify').toggleClass("notify_label_ok", "notify_label_error", 100, "easeInOutQuad");
					} else {
						alert(result.res.result);
					}
				});
			})

			$('#btn_CheckVerify').click(function() {
				var phone_number = $('#phone_number_prefix').val() + $('#phone_number1').val() + $('#phone_number2').val();
				var verify_key = $('#verify_key').val();
				if (!verify_key) {
					return alert('인증코드를 입력해주십시오.');
				}
				var params = {
					phone_number: phone_number,
					verify_key: verify_key
				}
				$.post(api_url + 'api/Accounts/check-verify', params, function(result) {
					if (result.res.success) {
						$('#label_verify').text('인증이 성공하였습니다.');
						$('#label_verify').attr('ok', true);
						$('#label_verify').switchClass("notify_label_error", "notify_label_ok", 100, "easeInOutQuad");
					} else {
						alert(result.res.result);
					}
				});
			})
			
			for (i = new Date().getFullYear() ; i > 1920; i--) {
				$('#birthday_year').append($('<option />').val(i).html(i));
			}
			for (i = 1; i < 13; i++) {
				$('#birthday_month').append($('<option />').val(i).html(i));
			}
			updateNumberOfDays();

			$('#birthday_year, #birthday_month').change(function () {
				updateNumberOfDays();
			});
			function updateNumberOfDays() {
				$('#birthday_days').html('');
				month = $('#birthday_month').val();
				year = $('#birthday_year').val();
				days = daysInMonth(month, year);
				for (i = 1; i < days + 1 ; i++) {
					$('#birthday_days').append($('<option />').val(i).html(i));
				}
			}
			function daysInMonth(month, year) {
				return new Date(year, month, 0).getDate();
			}
			function getBirthday() {
				var years = $('#birthday_year').val();
				var months = $('#birthday_month').val();
				var days = $('#birthday_days').val();
				return years + '/' + months + '/' + days;
			}

			$('#btn_CheckNickName').click(function() {
				var nickname = $('#text_nickname').val();
				if (!nickname || nickname.length == 0) {
					return alert('닉네임을 입력해주십시오.');
				}
				var params = {
					nickname: nickname,
				}
				$.post(api_url + 'api/Accounts/check-nickname', params, function(result) {
					if (result.res.success) {
						$('#label_checkNickName').text('사용가능한 닉네임입니다.');
						$('#label_checkNickName').attr('ok', true);
						{{!-- $('#label_checkNickName').switchClass("notify_label_error", "notify_label_ok", 100, "easeInOutQuad"); --}}
					} else {
						$('#label_checkNickName').text('중복된 닉네임이 있습니다.');
						$('#label_checkNickName').attr('ok', false);
						{{!-- $('#label_checkNickName').toggleClass("notify_label_ok", "notify_label_error", 100, "easeInOutQuad"); --}}
					}
				});
			})

			// 우편번호검색
			$('#btn_search_postnumber').click(function() {
				new daum.Postcode({
					oncomplete: function(data) {
						// 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

						// 각 주소의 노출 규칙에 따라 주소를 조합한다.
						// 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
						var addr = ''; // 주소 변수
						var extraAddr = ''; // 참고항목 변수

						//사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
						if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
							addr = data.roadAddress;
						} else { // 사용자가 지번 주소를 선택했을 경우(J)
							addr = data.jibunAddress;
						}

						// 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
						if(data.userSelectedType === 'R'){
							// 법정동명이 있을 경우 추가한다. (법정리는 제외)
							// 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
							if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
								extraAddr += data.bname;
							}
							// 건물명이 있고, 공동주택일 경우 추가한다.
							if(data.buildingName !== '' && data.apartment === 'Y'){
								extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
							}
							// 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
							if(extraAddr !== ''){
								extraAddr = ' (' + extraAddr + ')';
							}
							// 조합된 참고항목을 해당 필드에 넣는다.
							{{!-- document.getElementById("sample6_extraAddress").value = extraAddr; --}}
						
						} else {
							{{!-- document.getElementById("sample6_extraAddress").value = ''; --}}
						}

						// 우편번호와 주소 정보를 해당 필드에 넣는다.
						document.getElementById('text_postnumber').value = data.zonecode;
						document.getElementById("text_address1").value = addr;
						// 커서를 상세주소 필드로 이동한다.
						document.getElementById("text_address2").focus();
					}
				}).open();
			})
			
			$('#btn_CheckId').click(function() {
				var username = $('#text_username').val();
				if (!username || username.length == 0) {
					return alert('유저아이디를 입력해주십시오.');
				}
				if (username.length < 4 && username.length > 14) {
					return alert('유저아이디의 문자렬길이는 4~14이여야 합니다.');
				}
				if (/^[a-zA-Z0-9]*$/.test(username) == false) {
					return alert('영문, 숫자조합의 문자렬을 입력해주십시오.');
				}
				var params = {
					username: username,
				}
				$.post(api_url + 'api/Accounts/check-username', params, function(result) {
					if (result.res.success) {
						$('#label_checkId').text('사용가능한 아이디입니다.');
						$('#label_checkId').attr('ok', true);
						//$('#label_checkId').switchClass("notify_label_error", "notify_label_ok", 100, "easeInOutQuad");
					} else {
						$('#label_checkId').text('중복된 유저아이디가 있습니다.');
						$('#label_checkId').attr('ok', false);
						//$('#label_checkId').switchClass("notify_label_ok", "notify_label_error", 100, "easeInOutQuad");
					}
				});
			})


			$('#btn_OK').click(function() {
				if (!$('#label_verify').attr('ok')) return alert('전화번호인증을 해야 합니다.');
				if (!$('#label_checkId').attr('ok')) return alert('아이디중복검사를 해야 합니다.');
				if (!$('#label_checkNickName').attr('ok')) return alert('닉네임중복검사를 해야 합니다.');
				var phone_number = $('#phone_number_prefix').val() + $('#phone_number1').val() + $('#phone_number2').val();
				var username = $('#text_username').val();
				var nickname = $('#text_nickname').val();
				var password = $('#text_password').val();
				var password2 = $('#text_password2').val();
				if (!password || password.length == 0) {
					return alert('비밀번호를 입력해주십시오.');
				}
				if (password.length < 4 && password.length > 14) {
					return alert('비밀번호의 문자렬길이는 4~14이여야 합니다.');
				}
				if (password != password2) {
					return alert('비밀번호가 일치하지 않습니다.');
				}
				var age_less14 = $('input:radio[name="age_less14"]:checked').val() - 0;
				var realname = $('#text_realname').val();
				if (!realname || realname.length == 0) {
					return alert('실제이름을 입력해주십시오.');
				}
				var sex = $('input:radio[name="sex"]:checked').val();
				var mail = $('#text_mail').val();
				var address = {
					postnumber: $('#text_postnumber').val(),
					address1: $('#text_address1').val(),
					address2: $('#text_address2').val()
				}
				if (address.address1.length == 0 && address.address2.length == 0) {
					return alert('주소를 입력하여 주십시오.');
				}
				var params = {
					phone_number: phone_number,
					userId: username,
					nickname: nickname,
					password: password,
					age_less14: true,
					realname: realname,
					sex: sex,
					{{!-- mail: mail, --}}
					agree_marketting_email: true,
					agree_marketting_sns: true,
					birthday: getBirthday(),
					address: address,
					register_type: 'site'
				}
				$.post(api_url + 'api/Accounts/register', params, function(result) {
					if (result.res.success) {
						alert('등록이 성공하였습니다.');
						var params_login = {
							username: username,
							password: password
						}
						var origin   = window.location.origin;   // Returns base URL
						$.post(origin + '/loginUser', params_login, function(result) {
							if (result.res.success) {
								window.location.replace('/signupComplete');
							} else {
								return alert(result.res.content);
							}
						});
					} else {
						alert('등록이 실패하였습니다.')
					}
				});
			})
		})
	</script>
	</body>
</html>